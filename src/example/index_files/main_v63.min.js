var siteLib=function(i){return sl=this,sl.city={},this.product_count=1,this.updateCount=function(){i("#product-count").val(this.product_count)},this.init=function(){sl.updateCount(),i("#product-count").off("change"),i("#product-count").on("change",function(){sl.product_count=parseInt(i("#product-count").val())}),i("#counter-minus").on("click",function(){--sl.product_count,sl.product_count<=0&&(sl.product_count=1),sl.updateCount()}),i("#counter-plus").on("click",function(){sl.product_count+=1,sl.updateCount()})},this.CheckCity=function(){return i.post(document.location.href,{action:"CheckCity"})},this.getRates=function(){var t;return"Самара"!=sl.city.name&&(t='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>',i("#price_dellin").show(),i("#price_pek").show(),i("#price_energia").show(),i("#price_dellin").html(t),i("#price_pek").html(t),i("#price_energia").html(t),t="getDeliveryRates",i.post(document.location.href,{action:t,tk:"1"}).done(function(t){t=JSON.parse(t),i("#price_dellin").html(t.price)}).fail(function(){i("#price_dellin").hide()}),i.post(document.location.href,{action:t,tk:"2"}).done(function(t){t=JSON.parse(t),i("#price_pek").html(t.price)}).fail(function(){i("#price_pek").hide()}),i.post(document.location.href,{action:t,tk:"3"}).done(function(t){t=JSON.parse(t),i("#price_energia").html(t.price)}).fail(function(){i("#price_energia").hide()})),!1},this.getPromoCode=function(){var t=i("#promoCode").val();i("#promoCode").addClass("is-loading"),i(".errorpromocode").addClass("is-hidden"),i.post(document.location.href,{action:"applyPromoCode",promocode:t}).done(function(t){t=JSON.parse(t),i("#promoCode").removeClass("is-loading"),"success"==t?document.location.reload():i(".errorpromocode").removeClass("is-hidden")}).fail(function(){i("#promoCode").removeClass("is-loading"),i(".errorpromocode").removeClass("is-hidden")})},this.deletePromoCode=function(){i.post(document.location.href,{action:"deletePromoCode"}).done(function(t){"success"==(t=JSON.parse(t))&&document.location.reload(),document.location.reload()}).fail(function(){})},this.bindPlusMinusCart=function(){i(".content").on("click",".button__minus",function(){var t=i(this).parent().parent().find(".shk-count"),e=(e=parseInt(t.val())-1)<1?1:e;return t.val(e),t.change(),SHK.changeCartItemsCount(),!1}),i(".content").on("click",".button__plus",function(){var t=i(this).parent().parent().find(".shk-count");return t.val(parseInt(t.val())+1),t.change(),SHK.changeCartItemsCount(),!1})},this.bindPlusMinusProduct=function(){i(".button__plus-product").on("click",function(t){i(this).prop("disabled",!0);var e=i(this).parent().parent().find(".shk-count-product");return e.val(parseInt(e.val())+1),e.change(),i(this).prop("disabled",!1),!1}),i(".button__minus-product").on("click",function(t){i(this).prop("disabled",!0);var e=i(this).parent().parent().find(".shk-count-product"),o=(o=parseInt(e.val())-1)<1?1:o;return e.val(o),e.change(),i(this).prop("disabled",!1),!1})},this.bindCartTap=function(){var t,e=document.querySelector("#openfullcart");e&&(t=new Hammer.Manager(e),e=new Hammer.Tap({taps:1}),t.add(e),t.on("tap",function(t){i(".shopcart-full").toggleClass("collapsed")}),i(".shopcart-container").on("click","#CollapseShopCartButton",function(){i(".shopcart-full").addClass("collapsed")}),i(".shopcart-container").on("click",".product-list",function(){i(".shopcart-full").addClass("collapsed")}))},this.alert=function(t,e,o){o=o||3e3;e="alert-"+(e=e||"success");i(".alert-fixed").remove(),i("<div/>",{class:"alert alert-fixed "+e+" alert-dismissable",text:t,on:{mouseover:function(){clearTimeout(window.alertTimer)}}}).css({position:"fixed",zIndex:999,bottom:20,left:20,opacity:.9}).append(i("<button/>",{type:"button",class:"close",html:"&times;",on:{click:function(t){t.preventDefault(),clearTimeout(window.alertTimer),i(this).closest(".alert").remove()}}})).appendTo("body"),clearTimeout(window.alertTimer),window.alertTimer=setTimeout(function(){i(".alert-fixed").remove()},o)},this}.call({},jQuery);this.siteLib=siteLib,$(function(){siteLib.init();siteLib.CheckCity().done(function(t){"0"==JSON.parse(t)?$(".yourcity").css("display","block"):$(".yourcity").css("display","none")}),$(".more_info__show").on("click",function(){return $(".more_info__list").slideToggle(300),!1});var o=document.documentElement,t=$(".tabs li a");0<t.length&&t.each(function(t,e){$(e).on("click",function(){$(".tabs li").removeClass("is-active"),$(e.parentNode).addClass("is-active");var t=e.dataset.target;t="#"+t,$(".tab").removeClass("is-active"),$(t).addClass("is-active")})});var o=$("body"),e=$(".modal"),i=$(".modal-button"),t=$(".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button");function n(){$(o).removeClass("is-clipped"),e.each(function(t,e){$(e).removeClass("is-active")})}0<i.length&&i.each(function(t,e){$(e).on("click",function(t){t.preventDefault(),function(t){if($(o).addClass("is-clipped"),$(t).addClass("is-active"),"#city-select-form"==t){$("#city-select-form p.modal-card-title").html("Выберите область/город проживания:"),$("#CitySelectList").html('<div class="ajax-loader">Подождите...</div>');$.post(document.location.href,{action:"ShowRegionsList"}).done(function(t){var i=JSON.parse(t);$("#CitySelectList").html(""),i.forEach(function(t){$("#CitySelectList").append("<div class='pickcitycontainer'><a class='pickcity region' data-target='"+t.id+"'>"+t.name_ru+"</a></div>")});t=$(".pickcity.region");0<t.length&&t.each(function(o,e){$(e).on("click",function(t){t.preventDefault();t=e.dataset.target;$("#CitySelectList").html("Подождите..."),$.post(document.location.href,{action:"ShowCitiesByRegion",data:t}).done(function(t){$("#CitySelectList").html(""),cities=JSON.parse(t),cities.forEach(function(t){$("#CitySelectList").append("<div class='pickcitycontainer'><a class='pickcity city' data-target='"+t.id+"'>"+t.name_ru+"</a></div>")});t=$(".pickcity.city");0<t.length&&t.each(function(e,t){$(t).on("click",function(t){t.preventDefault(),$.post(document.location.href,{action:"PickCity",city:cities[e],region:i[o]},function(t){n(),location.reload()})})})})})})}).fail(function(t){})}}("#"+e.dataset.target)})}),0<t.length&&t.each(function(t,e){$(e).on("click",function(){n()})}),siteLib.closeModals=function(){n()},document.addEventListener("keydown",function(t){27===(t||window.event).keyCode&&n()}),$("#CityConfirmYes").on("click",function(){$.post(document.location.href,{action:"ConfirmCity"},function(t){$(".yourcity").css("display","none")})});try{mainpageCarousel=new Carousel(document.querySelector(".main-carousel"),{Dots:!0,Navigation:!0,center:!1,slidesPerPage:1,infinite:!0,hideScrollbar:!0,Autoplay:{timeout:2500}})}catch(t){}try{mainCarousel=new Carousel(document.querySelector("#productImages"),{Dots:!1})}catch{}var c="#productThumbs > .carousel__slide";$(c).first().addClass("is-nav-selected"),$(c).each(function(t){$(this).on("click",function(){$(c).removeClass("is-nav-selected"),mainCarousel.slideTo(t),$(this).addClass("is-nav-selected")})}),Fancybox.bind('[data-fancybox="gallery"]',{Carousel:{on:{change:function(t){mainCarousel.slideTo(mainCarousel.findPageForSlide(t.page),{friction:0})}}},hideScrollbar:!0}),$(".miniProductImages").each(function(t){var e="#"+$(this).attr("id");console.log(e);new Carousel(document.querySelector(e),{Dots:!1,Navigation:!0,center:!1,slidesPerPage:1,infinite:!0,hideScrollbar:!0})}),$(".country_delivery__item").on("click",function(){$(".country_delivery__item").removeClass("active"),$(this).addClass("active");var t=$(this).data("trans");$(".transcom").val(t)}),$(".product__order .button").on("click",function(){$(this).parent().find("#success-check").prop("checked",!0)}),$(document).on("af_complete",function(t,e){e.form.hasClass("consult-form")&&e.success}),$(".navbar-burger").on("click",function(){$(".navbar-burger").toggleClass("is-active"),$(".side-column").toggleClass("is-hidden-mobile")});t=$(".navbar-item.has-dropdown");function a(){$node=$(".pre_korzina"),$offset=$node.offset().top,$height=$node.height(),$width=$node.width();var t=$node.css("float"),e=$node.css("display"),o=$("<div id='PanelSpacer' style='width:"+$width+"px;height:"+$height+"px;float:"+t+";display:"+e+";'> </div>"),i=!1,n=null;$(window).off("scroll"),$(window).on("scroll",function(){$(window).scrollTop()>$offset-5?i||($height=$node.height(),$width=$node.width(),$node.before(o),n=$("#PanelSpacer"),$node.css("width",$width),$node.css("position","fixed"),$node.css("top","5px"),i=!0):i&&(i=!1,n.remove(),$(".pre_korzina").removeAttr("style"))})}"ontouchstart"in window?t.on("click",function(){$(this).toggleClass("is-active")}):t.on("mouseenter",function(){$(this).addClass("is-active")}).on("mouseleave",function(){$(this).removeClass("is-active")}),window.addEventListener("resize",a(),!0),window.addEventListener("load",a(),!0),window.addEventListener("reload",a(),!0),$("#shopOrderForm").on("submit",function(t){var e=$("#orderFormPhone").val(),o=(e=e.replace(/\s+/g,"")).length,i=e.split(""),n="",c=0;for("+"==i[0]&&"7"==i[1]&&(c+=2),"8"==i[0]||(n+="8");c<o;)switch(i[c]){case" ":case"-":case"+":case"(":case")":c++;break;default:n+=i[c],c++}for(var c=0,o=n.length,a=n.split(""),s="";c<o;)1==c&&(s+="("),4==c&&(s+=")"),7==c&&(s+="-"),9==c&&(s+="-"),s+=a[c],c++;$("#orderFormPhone").val(s)})}),$(document).ready(function(){var e=[];$(".cities li").each(function(t){void 0===$(this).attr("target")?e[t]=$(this).html():e[t]=$(this).attr("target"),console.log(e[t])}),null!==document.querySelector("ul.cities")&&ymaps.ready(function(){var a=new ymaps.Map("cont_map",{center:[55.753994,37.622093],zoom:9,controls:["smallMapDefaultSet"]}),o=ymaps.geoQuery();e.forEach(function(t){o=o.add(ymaps.geocode(t,{results:1,kind:"locality"}))}),(o=o.applyBoundsToMap(a).addToMap(a)).then(function(t){var c=$("#selectedTable");boundz=a.getBounds(),$("#return").click(function(){a.setBounds(boundz),a.geoObjects.removeAll(),c.html(" "),o.addToMap(a),$("ul.cities>li").removeClass("active")}),$("ul.cities>li").click(function(){c.html(" "),a.geoObjects.removeAll(),$("ul.cities>li").removeClass("active"),$(this).addClass("active");var t="",t=void 0===$(this).attr("target")?$(this).html():$(this).attr("target");siteLib.closeModals(),"Москва"==t&&(t="Московская область"),o.removeFromMap(a);var e=$(this).html();ymaps.geocode(e,{results:1,kind:"locality"}).then(function(t){t.geoObjects.get(0).geometry.getCoordinates();t=t.geoObjects.get(0).properties.get("boundedBy");a.setBounds(t,{checkZoomRange:!0})});var t=$("#fullList>tbody>tr[city='"+t+"']"),n=[];t.each(function(t){n[t]=$(this),c.append('<tr class="listed" id="num_'+t+'"><td>'+(t+1)+"</td>"+n[t].html()+"</tr>");var e=[],o=$(this).find("td[geo_code]").attr("geo_code").split(",").reverse();$(this).find("td").each(function(t){e[t]=$(this).html()});var i=new ymaps.Placemark(o,{iconContent:t+1},{preset:"islands#icon"});c.find("tr#num_"+t).click(function(){c.html(n[t].html()),a.setCenter(o),a.setZoom("15")}),i.events.add("click",function(){c.html(n[t].html()),a.setCenter(o),a.setZoom("15")}),a.geoObjects.add(i)})})})})});